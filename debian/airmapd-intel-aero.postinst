#!/bin/sh

set -e

. /usr/share/debconf/confmodule

# create_airmapd_config creates a configuration for airmapd with
# a hard-coded api key and an id that defaults to the MAC of the
# first wireless interface present on the device.
create_airmapd_config()
{
mkdir -p /etc/airmap/aero

cat << EOF > /etc/airmap/aero/config.json
{
    "host": "api.airmap.com",
    "version": "production",
    "sso": {
        "host": "sso.airmap.io",
        "port": 443
    },
    "telemetry": {
        "host": "api.k8s.stage.airmap.com",
        "port": 32003
    },
    "traffic": {
        "host": "mqtt-prod.airmap.io",
        "port": 8883
    },
    "credentials": {
        "api-key": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjcmVkZW50aWFsX2lkIjoiY3JlZGVudGlhbHxrOEFkMmxtU29PWXlHR1NlcWdMMGJpTzNvbW1tIiwiYXBwbGljYXRpb25faWQiOiJhcHBsaWNhdGlvbnxENkc0V2JsSU1wR1piZXVweHdENTRoTUFiblE1Iiwib3JnYW5pemF0aW9uX2lkIjoiZGV2ZWxvcGVyfDN4OWQ1YThVV21iRGJYUzZkNlJKYkhQTHlaUHkiLCJpYXQiOjE1MDAzMDg2NzJ9.szMZec56G-HjeWT5XfG9vsgJUHwgnRcvzMx4nwPpkTg",
        "anonymous": {
            "id": "$(cat /sys/class/net/wl*/address)"
        }
    }
}
EOF
}

case "$1" in

  configure)
    # Set up our config for lighttpd
    create_airmapd_config
  ;;

  abort-upgrade|abort-remove|abort-deconfigure)
    exit 0
  ;;

  *)
    echo "postinst called with unknown argument \`$1'" >&2
    exit 1
  ;;

esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
